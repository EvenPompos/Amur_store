<Page x:Class="Amur_store.Views.CartPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Title="Корзина"
      Loaded="Page_Loaded">
    <Grid>
        <Grid.Background>
            <LinearGradientBrush StartPoint="0.1,0" EndPoint="0.9,1">
                <GradientStop Color="#FF0A2463" Offset="0" />
                <GradientStop Color="#FF1E3A8A" Offset="1" />
            </LinearGradientBrush>
        </Grid.Background>

        <Border Height="150" VerticalAlignment="Top" CornerRadius="0 0 120 0" Background="#100E17" Opacity="0.9"/>

        <StackPanel Margin="40,40,40,0" VerticalAlignment="Top">
            <TextBlock Text="Корзина" FontSize="36" Foreground="White" FontWeight="Bold"/>
            <TextBlock x:Name="CartInfoText" Text="Загрузка..." FontSize="16" Foreground="#A0B3E0" Margin="0,5,0,0"/>
        </StackPanel>

        <Border x:Name="CartContentPanel" Background="#1A2030" CornerRadius="12" Margin="40,130,40,40" BorderBrush="#2A3348" BorderThickness="1">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="150"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <DataGrid x:Name="CartDataGrid" Grid.Row="0" Margin="20,20,20,0"
                          AutoGenerateColumns="False" CanUserAddRows="False"
                          Background="Transparent" BorderBrush="#2A3348"
                          RowBackground="#1A2030" AlternatingRowBackground="#151A28"
                          Foreground="White" IsReadOnly="True" GridLinesVisibility="Horizontal">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Товар" Binding="{Binding ProductName}" Width="*"/>

                        <DataGridTextColumn Header="Цена" 
                                            Binding="{Binding Price, StringFormat={}{0:N0} ₽}" 
                                            Width="100"/>

                        <DataGridTextColumn Header="Кол-во" 
                                            Binding="{Binding Quantity}" 
                                            Width="80"/>

                        <DataGridTextColumn Header="Сумма" 
                                            Binding="{Binding Total, StringFormat={}{0:N0} ₽}" 
                                            Width="100" FontWeight="Bold"/>

                        <DataGridTemplateColumn Header="Действия" Width="150">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button Content="Удалить" Tag="{Binding ProductID}" 
                                            Click="RemoveItemButton_Click"
                                            Background="#EF4444" Foreground="White" 
                                            Width="100" Height="25" Cursor="Hand"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>

                <Border Grid.Row="1" Background="#151A28" CornerRadius="8" 
        Margin="20,20,20,20" Padding="20">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0" VerticalAlignment="Top" Width="260">

                            <Border Background="#232D42" CornerRadius="6" Padding="10" Margin="0,0,0,15" BorderBrush="#2A3348" BorderThickness="1">
                                <StackPanel>
                                    <CheckBox x:Name="AssemblyCheckBox" 
                              Content="Сборка ПК (+3 000 ₽)"
                              Foreground="#FBBF24" FontWeight="SemiBold" FontSize="14"
                              Checked="AssemblyCheckBox_Changed"
                              Unchecked="AssemblyCheckBox_Changed"
                              Cursor="Hand"/>

                                    <StackPanel x:Name="MasterSelectionPanel" Visibility="Collapsed" Margin="0,10,0,0">
                                        <TextBlock Text="Мастер:" Foreground="#A0B3E0" FontSize="12" Margin="0,0,0,4"/>
                                        <ComboBox x:Name="MastersComboBox" 
                                  DisplayMemberPath="FullName" 
                                  SelectedValuePath="EmployeeID"
                                  Height="28" FontSize="13"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>

                            <Button x:Name="ClearCartButton" Content="Очистить корзину" 
                    Background="Transparent" Foreground="#EF4444" BorderBrush="#EF4444" BorderThickness="1"
                    Height="30" Click="ClearCartButton_Click" Cursor="Hand">
                                <Button.Resources>
                                    <Style TargetType="Border">
                                        <Setter Property="CornerRadius" Value="4"/>
                                    </Style>
                                </Button.Resources>
                            </Button>
                        </StackPanel>

                        <StackPanel Grid.Column="2" MinWidth="250" VerticalAlignment="Top">

                            <Grid Margin="0,0,0,8">
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                                    <TextBlock Text="Доставка:" Foreground="#A0B3E0" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <ComboBox x:Name="DeliveryComboBox" Width="120" Height="25" FontSize="12"
                              SelectionChanged="DeliveryComboBox_SelectionChanged">
                                        <ComboBoxItem Content="Самовывоз" Tag="0" IsSelected="True"/>
                                        <ComboBoxItem Content="Курьер" Tag="500"/>
                                        <ComboBoxItem Content="СДЭК" Tag="1250"/>
                                        <ComboBoxItem Content="Почта РФ" Tag="350"/>
                                    </ComboBox>
                                </StackPanel>
                                <TextBlock x:Name="DeliveryCostText" Text="0 ₽" Foreground="White" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                            </Grid>

                            <Grid Margin="0,0,0,8">
                                <TextBlock Text="Товары:" Foreground="#A0B3E0" HorizontalAlignment="Left"/>
                                <TextBlock x:Name="SubtotalText" Text="0 ₽" Foreground="White" HorizontalAlignment="Right"/>
                            </Grid>

                            <Separator Background="#2A3348" Margin="0,5,0,10"/>

                            <Grid Margin="0,0,0,15">
                                <TextBlock Text="ИТОГО:" Foreground="#FBBF24" FontWeight="Bold" FontSize="18" HorizontalAlignment="Left" VerticalAlignment="Bottom"/>
                                <TextBlock x:Name="TotalText" Text="0 ₽" Foreground="#FBBF24" FontWeight="Bold" FontSize="22" HorizontalAlignment="Right" VerticalAlignment="Bottom"/>
                            </Grid>

                            <Button x:Name="CheckoutButton" Content="ОФОРМИТЬ ЗАКАЗ" 
                    Background="#3B82F6" Foreground="White" FontWeight="Bold" FontSize="14"
                    Height="45" Cursor="Hand"
                    Click="CheckoutButton_Click">
                                <Button.Resources>
                                    <Style TargetType="Border">
                                        <Setter Property="CornerRadius" Value="6"/>
                                    </Style>
                                </Button.Resources>
                            </Button>

                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>
        </Border>

        <Border x:Name="EmptyCartPanel" Background="#1A2030" CornerRadius="12" 
                Margin="40,130,40,40" BorderBrush="#2A3348" BorderThickness="1"
                Visibility="Collapsed">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <TextBlock Text="🛒" FontSize="72" HorizontalAlignment="Center" Margin="0,0,0,20"/>
                <TextBlock Text="В корзине пусто" FontSize="24" Foreground="White" FontWeight="Bold" HorizontalAlignment="Center"/>
                <TextBlock Text="Перейдите в каталог, чтобы выбрать товары" FontSize="16" Foreground="#A0B3E0" HorizontalAlignment="Center" Margin="0,10,0,0"/>

                <Button x:Name="GoToCatalogButton" Content="Перейти в каталог" 
                        Background="#3B82F6" Foreground="White"
                        Height="40" Width="200" Margin="0,30,0,0" Click="GoToCatalogButton_Click"/>
            </StackPanel>
        </Border>
    </Grid>
</Page>